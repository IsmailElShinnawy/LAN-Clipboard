<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/styles.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <title>LAN clipboard</title>
</head>

<body>
    <!-- SIDE BAR -->
    <div id="mySidenav" class="sidenav">
        <a href="#">Home</a>
        <a href="#">My Clipboard</a>
        <a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a>
    </div>

    <div id="main">
        <span style="font-size:30px;cursor:pointer" onclick="toggleNav()">&#9776;</span>
    </div>
    <!-- END OF SIDE BAR -->

    <div class="container">
        <!--Form for user to paste manually-->
        <form class="myForm" method="POST" action="/items">
            <div class="input-group" style="z-index: 0;">
                <input type="text" class="form-control" placeholder="paste here..." name="new_item" id="new_item">
                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                        <i class="glyphicon glyphicon-chevron-right"></i>
                    </button>
                </div>
            </div>
        </form>

        <div class="clipboard">
            <% if(content.length > 0) { %> 
                <% content.forEach((item, index) => { %>
                    <div class="item-wrapper">
                        <div class="item">
                            <p id="text-<%= item.item_id %>"><%= item.text %></p>
                            <footer class="blockquote-footer"><%= item.login_name %><br>at <cite title=""><%= item.timestamp %></cite></footer>
                        </div>
                        <button type="button" class="btn" style="margin: 5px" onclick="copyToClipboard('#text-<%= item.item_id %>')">
                            <span class="glyphicon glyphicon-copy">
                        </button>
                        <button type="button" class="btn btn-danger delete-button" data-itemid="<%= item.item_id %>">
                            <span class="glyphicon glyphicon-trash">
                        </button>
                    </div>
                <% }); %>
            <% } %> 
        </div>
    </div>


    
    <script>
        // SIDE BAR functions
        let isClosed = true;
        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
            isClosed = false;
        }

        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
            isClosed = true;
        }

        function toggleNav() {
            if (isClosed) openNav();
            else closeNav();
        }
        // END OF SIDE BAR functions

        // COPY TO CLIPBOARD functions
        function copyToClipboard(element) {
            const $temp = $("<input>");
            $("body").append($temp);
            $temp.val($(element).text()).select();
            document.execCommand("copy");
            $temp.remove();
        }
        // END OF COPY TO CLIPBOARD functions

        // DELETE FROM CLIPBOARD functions
        const trashcans = document.querySelectorAll('button.delete-button');
        // console.log(trashcans);
        trashcans.forEach((trashcan) => {
            trashcan.addEventListener('click', (e) => {
                const endpoint = `/items/${trashcan.dataset.itemid}`;
                fetch(endpoint, {
                    method: 'DELETE',
                })
                    .then((response) => response.json())
                    .then((data) => {console.log(data.redirect); window.location.href = data.redirect})
                    .catch((err) => console.log(err));
            });
        });
        // END OF DELETE FROM CLIPBOARD functions
    </script>
</body>

</html>